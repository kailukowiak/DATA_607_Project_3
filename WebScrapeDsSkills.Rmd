---
title: "Webscraping to Find Key DS Skills"
author: "Kai Lukowiak"
date: '2017-10-12'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Project 3

The goal of project 3 is to find key skills for data scientists and put these into a relational database as well as perform some baisic data analysis.

### Loading Libraries.

```{r}
library(RCurl)
library(XML)
library(rvest)
library(knitr)
```

Proof of Concept:
```{r}
url <- "https://www.indeed.com/jobs?q=data+science&l=New+York" #Test URL
ineeedPage <- read_html(url) # reading to make a list.

#Creating columns of the dataframe:

ExperienceList <- ineeedPage %>%
  html_nodes(".experienceList") %>%
  html_text()


TitleName <- ineeedPage %>%
  html_nodes(".jobtitle") %>%
  html_text()


CompanyName <- ineeedPage %>%
  html_nodes(".company") %>%
  html_text()

City <- ineeedPage %>%
  html_nodes(".location") %>%
  html_text()


#creating DataFrame
df <- data.frame(CompanyName,TitleName, City, ExperienceList)
kable(df)
```


Function to itterate over cities.

```{r}
# Functions

indeedCities <- function(jobTitle, city, state){
  url <- paste0("https://www.indeed.com/jobs?q=",
                gsub(" ", replacement = "+", jobTitle),
                "&l=",
                gsub(" ", replacement = "+", city),
                "%2C+", 
                state, 
                sep = "")
  
  return(url)
}
```


Itterate over 3 pages
```{r}
itter <- c("", "&start=10", "&start=20", "&start=30")
itterIndeed <- function(x){
  for(i in itter)
  print(paste(i))
}

```


Find multiple URLs for all cities:

```{r}
# Functions
itter <- c("", "&start=10", "&start=20", "&start=30")
IndeedCities2 <- function(jobTitle, city, state){
  url <- c() #To make a list with multiple returns.
  for(i in itter){ # create urls
  i <- paste0("https://www.indeed.com/jobs?q=",
                gsub(" ", replacement = "+", jobTitle),
                "&l=",
                gsub(" ", replacement = "+", city),
                "%2C+", 
                state, 
                i,
                sep = "")
  url <- c(url, i) #Update list of urls
  print(i) #verifies correct operation. 
  }
  return(url)
}
```


```{r}
nyc <-  IndeedCities2("Data Scientist", "New York", "NY")
bost <- IndeedCities2("Data Scientist", "Boston", "MA")
sanFran <- IndeedCities2("Data Scientist", "San Francisco", "CA")
hust <- IndeedCities2("Data Scientist", "Houston", "TX")
sea <- IndeedCities2("Data Scientist", "Seattle", "WA")
```

```{r}
df1 <- data.frame(CompanyName = as.character(),
                  TitleName= as.character(),
                  City= as.character(),
                  ExperienceList= as.character())
url <- "https://www.indeed.com/jobs?q=data+science&l=New+York" #Test URL
IndeedData <- function(x){
  for(i in c(1:4)){
    ineeedPage <- read_html(x[i]) # reading to make a list.

   #Creating columns of the dataframe:

   ExperienceList <- ineeedPage %>%
      html_nodes(".experienceList") %>%
      html_text()


    TitleName <- ineeedPage %>%
     html_nodes(".jobtitle") %>%
     html_text()


    CompanyName <- ineeedPage %>%
      html_nodes(".company") %>%
      html_text()

    City <- ineeedPage %>%
      html_nodes(".location") %>%
      html_text()
    df <- data.frame(CompanyName,TitleName, City, ExperienceList)
    df1 <- rbind(df1,df)
  }
 return(df1)
}

#creating DataFrame
# df <- data.frame(CompanyName,TitleName, City, ExperienceList)
# kable(df)
```

```{r}
test <- IndeedData(nyc) 
kable(test)
```

```{r}
```

